<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/styles.css" th:href="@{/css/styles.css}">
    <title>Leaderboards</title>
</head>
<body>
    <h1>Leaderboard</h1>
    <p>Check out the top players</p>
    <div class="sub-container-wrapper">
        <div class="sub-container">
            <form id="leaderboardForm">
                <label for="difficulty">Difficulty:</label>
                <select id="difficulty" name="difficulty">
                    <option value="1">Easy</option>
                    <option value="2">Medium</option>
                    <option value="3">Hard</option>
                </select>
                <button type="button" onclick="sumbitForm()">Show Leaderboard</button>
        </form>
        </div>
    </div>
    <div class="top-right-container">
        <p><b>Logged in as:</b></p>
        <p><span th:text="${username}">Username</span></p>
        <p><span th:text="${email}">email</span></p>
        <a href="/logout">Logout</a>
    </div>
    <div class="top-left-container">
        <p><b>Fun Games</b></p>
        <a href="/home">Home</a>
    </div>
    <div class="games-container">
        <p><b>Games</b></p>
        <a class="nav-link" href="/pexeso-menu">Pexeso</a>
        <a class="nav-link">Placeholder</a>
        <p><b>Leaderboards</b></p>
        <a class="nav-link" href="/leaderboards">Leaderboards</a>
        <p><b>Forum</b></p>
        <a class="nav-link">Forum</a>
    </div>
    <div class="sub-container-wrapper">
        <div class="sub-container">
            <h2>Leaderboard</h2>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Score</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <!-- Leaderboard data will be populated here -->
                </tbody>
            </table>
            <a id="turnPageDownButton" style="margin: 5px; margin-top: 10px;" onclick="turnPageDown()">&lt;</a><a style="margin: 5px; margin-top: 10px;" onclick="turnPageUp()">></a>
            <p>[<span id="globalBottom"></span> - <span id="globalTop"></span>]</p>
        </div>
    </div>

    <script>
        var global_bottom = 0;
        var global_top = 19;

        var global_difficulty;

        function getResultsToLeaderboard(top, bottom, difficulty) {
            var url = '/results';
            if (top) {
                url += '?top=' + top;
            }
            if (bottom) {
                url += '&bottom=' + bottom;
            }
            if (difficulty) {
                url += '&difficulty=' + difficulty;
            }

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    updateNavigationButtonVisibility();
                    document.getElementById("globalBottom").textContent = global_bottom + 1;
                    document.getElementById("globalTop").textContent = global_top + 1;
                    const leaderboardBody = document.getElementById("leaderboardBody");
                    leaderboardBody.innerHTML = ""; // Clear existing rows
                    data.forEach((result, index) => {
                        const row = document.createElement("tr");
                        const rankCell = document.createElement("td");
                        // Calculate rank based on global_bottom and index
                        rankCell.textContent = global_bottom + index + 1;
                        const playerCell = document.createElement("td");
                        playerCell.textContent = result.user.username;
                        const scoreCell = document.createElement("td");
                        scoreCell.textContent = result.score;
                        row.appendChild(rankCell);
                        row.appendChild(playerCell);
                        row.appendChild(scoreCell);
                        leaderboardBody.appendChild(row);
                    });
                });
        }

        function turnPageUp() {
            global_bottom += 20;
            global_top += 20;
            getResultsToLeaderboard(global_top, global_bottom, global_difficulty);
        }

        function turnPageDown() {
            global_bottom -= 20;
            global_top -= 20;
            getResultsToLeaderboard(global_top, global_bottom, global_difficulty);
        }

        function updateNavigationButtonVisibility() {
            const turnPageDownButton = document.getElementById("turnPageDownButton");
            if (global_bottom === 0) {
                turnPageDownButton.style.visibility = "hidden";
            } else {
                turnPageDownButton.style.visibility = "visible";
            }
        }

        function sumbitForm() {
            global_bottom = 0;
            global_top = 19;
            const difficulty = document.getElementById("difficulty").value;
            global_difficulty = difficulty;
            getResultsToLeaderboard(19, 0, global_difficulty);
        }

        window.onload = function() {
            getResultsToLeaderboard(19, 0, 1);
            updateNavigationButtonVisibility(); // This call might be redundant if getResultsToLeaderboard already handles it
         };
    </script>
</body>
</html>